<div xmlns="http://www.w3.org/1999/xhtml" 
     xmlns:tal="http://xml.zope.org/namespaces/tal"
     xmlns:metal="http://xml.zope.org/namespaces/metal" 
     metal:use-macro="api.generic_layout">

    <div metal:fill-slot="admin-js" tal:omit-tag="">
        <metal:resources use-macro="api.snippets.macros['admin_scripts']" />
    </div>

  <div metal:fill-slot="content">
 
    <div class="content-2-3">
        <div class="top"></div>
        <div class="mid">
            <h3>${api.page_title}</h3>
            <form id="edit-profile" class="admin-form" action="" method="post" enctype="multipart/form-data" accept-charset="utf-8" tal:define="formprefix 'profile.'">
                <!-- whats this all about?  required when editing a profile as 'admin' type user
                <fieldset metal:use-macro="api.formfields.macros['login-field']"/>
                <<fieldset metal:use-macro="api.formfields.macros['group-fields']"/>
                <fieldset metal:use-macro="api.formfields.macros['home-path-field']"/>-->
      
                <div tal:content="structure api.render_form_widget('input', 'profile.firstname', 'First name', compulsory=True)"></div>
                <div tal:content="structure api.render_form_widget('input', 'profile.lastname', 'Last name')"></div>
                <div tal:content="structure api.render_form_widget('input', 'profile.description', 'A motto or line that describes you')"></div>
                <div tal:content="structure api.render_form_widget('textarea', 'profile.biography', 'About you')"></div>
                <div tal:content="structure api.render_form_widget('input', 'profile.position', 'Occupation')"></div>
                <div tal:content="structure api.render_form_widget('input', 'profile.organization', 'Company')"></div>
                <div tal:content="structure api.render_form_widget('textarea', 'profile.websites', 'Websites (please start urls with http://)', default='\r\n'.join(api.formdata.get('profile.websites', [])))"></div>
                <!--
                <div tal:content="structure api.render_form_widget('input', 'profile.twitter', 'Twitter Username')"></div>
                <div tal:content="structure api.render_form_widget('input', 'profile.facebook', 'Facebook page')"></div>
                -->
                <div tal:content="structure api.render_form_widget('input', 'profile.email', 'Email address', compulsory=True)"></div>
                <div tal:content="structure api.render_form_widget('select_list', 'profile.country', 'Country', choices=countries)"></div>
                <div tal:content="structure api.render_form_widget('image', 'profile.photo', 'Photo')"></div>

                <div tal:content="structure api.render_form_widget('password', 'profile.password', 'Password')"/>
                <div tal:content="structure api.render_form_widget('password', 'profile.password_confirm', 'Confirm Password')"/>

                <div metal:define-slot="expert_profile_fields" tal:omit-tag=""/>

                <div class="l-spacer"></div>
                
                <label>Challenge email preferences</label>
                <table>
                    <tr>
                        <th width="200"></th>
                        <th></th>
                        <th width="100">Immediately</th>
                        <th width="100">Digest</th>
                        <th width="100">Never</th>
                    </tr>
                    <tr tal:condition="len(challenges) == 0">
                        <td colspan="4">You do not have any challenges yet</td>
                    </tr>
                    <tr tal:repeat="challenge challenges">
                      <td>
                        <div tal:content="structure api.render_form_widget('hidden', 'profile.alert_preferences--%d.challenge' % repeat.challenge.index, '', default=challenge[0])"></div>
                        ${challenge[1]}
                      </td>
                      <td tal:content="structure api.render_form_widget('radio_list_table', 'profile.alert_preferences--%d.preference' % repeat.challenge.index, challenge[1], choices=preferences, default=challenge[2])"></td>
                    </tr>
                </table>


                
                <metal:resources use-macro="api.snippets.macros['submit-buttons']"/>
            </form>
        </div>
        <div class="bot"></div>
    </div>

  </div>
</div>
